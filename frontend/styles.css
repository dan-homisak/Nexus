:root {
  --bg:#0e0f12; --bg2:#12141a; --card:#12141a; --border:#252938; --text:#e6e6e6; --muted:#aab3c7;
  --accent:#2a334a; --ok:#3da57a; --warn:#d09d3d; --err:#d05c5c;
  --tree-gap:6px; --tree-line:rgba(142,163,200,0.38);
  --tag-bg: hsl(220 12% 16%);
  --tag-bg-hover: hsl(220 12% 21%);
  --tag-border: hsl(220 14% 28%);
  --tag-text: #ffffff;
  --tag-warn: hsl(30 70% 58%);
  --tag-warn-bg: hsla(30 70% 58% / .15);
  --tag-info: hsl(208 70% 68%);
  --tag-info-bg: hsla(208 70% 68% / .18);
  --ring: hsl(208 100% 64%);
  --popover-bg: hsl(220 14% 12%);
  --popover-border: hsl(220 18% 26%);
}
* { box-sizing: border-box; }
body { font-family: system-ui, Segoe UI, Roboto, Arial, sans-serif; margin: 0; background:var(--bg); color:var(--text); }
header, footer { padding: 12px 16px; background:#151821; border-bottom:1px solid var(--border); }
header h1 { margin: 0 0 8px 0; font-size: 18px; }
.toolbar { display:flex; gap:8px; align-items:center; }
.toolbar input { max-width: 220px; }

nav { display:flex; gap:8px; padding:8px 16px; border-bottom:1px solid var(--border); background:#12141a; position:sticky; top:0; z-index:10; }
nav button, button { background:#1d2230; color:var(--text); border:1px solid #2b3347; border-radius:8px; padding:8px 10px; cursor:pointer; transition:transform .04s ease; }
button.btn-primary { background:#42598f; border-color:#5f7ad3; color:#e5ecff; }
button.btn-primary:hover { background:#516cb3; }
nav button:active, button:active { transform: translateY(1px); }
nav button.active { background:#2a334a; }

#content { padding: 16px; }
.card { background:var(--card); border:1px solid var(--border); border-radius:12px; padding:12px; margin-bottom:12px; }
.card h3 { margin: 0 0 8px; font-size: 16px; color:#d7dbea; }

.table { width:100%; border-collapse: collapse; font-size:14px; }
.table th, .table td { border-bottom:1px solid var(--border); padding:8px; vertical-align: top; }
.table th { text-align:left; color:#b9c0d0; }

.input, select, textarea { background:#0e0f12; color:var(--text); border:1px solid #2b3347; border-radius:6px; padding:6px; width:100%; font-size:13px; line-height:1.4; }
.dropdown { position:relative; width:100%; }
.dropdown-box { display:flex; align-items:center; gap:4px; border:1px solid #2b3347; border-radius:6px; background:#0e0f12; padding:2px 6px; transition:border-color .12s ease; }
.dropdown-input { flex:1; background:transparent; border:none; color:var(--text); font:inherit; outline:none; min-width:0; font-size:13px; line-height:1.4; }
.dropdown-toggle { border:none; background:none; color:#b7c0d4; cursor:pointer; font-size:12px; padding:2px 4px; }
.dropdown.open .dropdown-box { border-color:#3f4d6b; box-shadow:0 0 0 2px rgba(66, 90, 140, 0.25); }
.dropdown-menu { position:absolute; top:calc(100% + 4px); left:0; right:0; background:#10141d; border:1px solid #2b3347; border-radius:8px; box-shadow:0 12px 24px rgba(0,0,0,.35); max-height:240px; overflow-y:auto; padding:4px 0; z-index:200; display:none; }
.dropdown.open .dropdown-menu { display:block; }
.dropdown-item { display:flex; align-items:center; justify-content:space-between; gap:6px; padding:6px 10px; cursor:pointer; font-size:13px; color:#d7dbea; }
.dropdown-item:hover, .dropdown-item.highlight { background:#1a2234; }
.dropdown-label { flex:1; }
.dropdown-action { border:none; background:none; color:#8fa5ce; cursor:pointer; font-size:12px; padding:0 2px; }
.dropdown-action:hover { color:#e2ecff; }
.dropdown-empty { padding:8px 10px; font-size:12px; color:#8b95ab; }
.dropdown-no-edit .dropdown-edit { display:none; }
.dropdown-no-delete .dropdown-delete { display:none; }
.dropdown-input::placeholder { color:#58627a; }
.dropdown-menu::-webkit-scrollbar { width:6px; }
.dropdown-menu::-webkit-scrollbar-thumb { background:#2b3347; border-radius:3px; }
.dropdown-menu::-webkit-scrollbar-track { background:transparent; }
.dropdown [data-dropdown-native] { display:none; }
.row { display:grid; grid-template-columns: repeat(6, 1fr); gap:8px; }
.row.two { grid-template-columns: repeat(2, 1fr); }
.row.three { grid-template-columns: repeat(3, 1fr); }
.row.four { grid-template-columns: repeat(4, 1fr); }
.field { display:flex; flex-direction:column; gap:4px; }
.field label { font-size:12px; color:#aab3c7; display:flex; align-items:center; gap:6px; }
.field .required::after { content:"*"; color:var(--warn); margin-left:4px; }

.badge { font-size:12px; padding:2px 6px; border:1px solid #2b3347; border-radius:999px; color:#c9d1e1; }
.badge.req { border-color:#5a4b25; background:#2b2111; color:#e9c27a; }
.badge.tip { border-color:#3a4b5e; background:#17212c; }

.info { display:inline-flex; align-items:center; justify-content:center; width:16px; height:16px; border-radius:50%; font-size:11px; line-height:16px; color:#cfe0ff; border:1px solid #3a4b5e; background:#17212c; cursor:help; position:relative; }
.info::after {
  content: attr(data-tip);
  position:absolute; left:50%; transform:translateX(-50%) translateY(-6px);
  bottom:22px; white-space:pre-wrap; pointer-events:none;
  background:#0e0f12; border:1px solid #334056; color:#e6eefb;
  border-radius:8px; padding:8px 10px; width:280px; max-width:60vw; opacity:0; transition:opacity .12s ease, transform .12s ease;
  box-shadow: 0 8px 24px rgba(0,0,0,.35);
  z-index: 20;
}
.info:hover::after { opacity:1; transform:translateX(-50%) translateY(-2px); }

.section { border:1px solid var(--border); border-radius:12px; padding:12px; margin-bottom:12px; background:#111319; }
.section > .title { font-size:13px; color:#b7c0d4; margin-bottom:8px; display:flex; align-items:center; gap:8px; }
.section .title .hint { color:#93a1bc; font-size:12px; }

.help-box { background:#101520; border:1px dashed #2b3347; border-radius:10px; padding:10px; color:#cfd6e6; }
.help-box h4 { margin:0 0 6px; font-size:13px; color:#e0e6f5; }
.help-box p { margin:4px 0; color:#bfc9dc; font-size:13px; }
.help-box code { background:#0c0f15; border:1px solid #2b3347; padding:0 4px; border-radius:4px; }

.invalid { outline:1px solid var(--err); }
button[disabled] { opacity:.6; cursor:not-allowed; }

.tree { padding-left: 16px; }
.badge.stat { border-radius:6px; padding:2px 6px; font-weight:600; }
.stat-green { background:#122317; border:1px solid #2a5f3b; color:#88d3a9; }
.stat-yellow { background:#2b2411; border:1px solid #6b5822; color:#e9c27a; }
.stat-red { background:#2a1213; border:1px solid #7a2e33; color:#f2a2a7; }
.progress { height:8px; background:#0c0f15; border:1px solid #2b3347; border-radius:6px; overflow:hidden; }
.progress > div { height:100%; background:#2a5f3b; }
.progress.warn > div { background:#6b5822; }
.progress.err > div { background:#7a2e33; }

.drawer {
  position: fixed;
  top: 0;
  right: 0;
  bottom: 0;
  width: 340px;
  background: #111319;
  border-left: 1px solid var(--border);
  box-shadow: -6px 0 12px rgba(0,0,0,0.25);
  padding: 16px;
  z-index: 900;
  overflow-y: auto;
}
.drawer.hidden { display:none; }
.drawer-panel { display:flex; flex-direction:column; gap:12px; }
.drawer-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; }
.drawer-header button { border:none; background:none; color:var(--text); font-size:20px; cursor:pointer; }
.drawer .actions { margin-top:12px; }

.report-list { list-style:none; margin:0; padding:0; }
.report-list li { padding:8px; border-bottom:1px solid var(--border); cursor:pointer; }
.report-list li:hover { background:#1a1f2b; }

/* --- Funding Sources Ledger --- */
.funding-shell { display:grid; grid-template-columns:260px minmax(0,1fr); gap:18px; align-items:flex-start; }
.funding-shell.has-inspector { grid-template-columns:260px minmax(0,1fr) 320px; }
.funding-sidebar { display:flex; flex-direction:column; gap:12px; background:var(--card); border:1px solid var(--border); border-radius:12px; padding:12px; position:sticky; top:72px; max-height:calc(100vh - 96px); overflow:auto; }
.funding-toolbar { display:flex; flex-direction:column; gap:10px; position:sticky; top:0; padding-bottom:8px; background:linear-gradient(180deg, rgba(18,20,26,0.98) 0%, rgba(18,20,26,0.85) 65%, rgba(18,20,26,0)); z-index:1; }
.funding-toolbar-actions { display:flex; gap:6px; flex-wrap:wrap; }
.funding-toolbar-actions button { font-size:11px; padding:6px 10px; }
.funding-toolbar input { width:100%; font-size:12px; padding:6px 8px; }
.funding-list { flex:1; overflow-y:auto; display:flex; flex-direction:column; gap:6px; padding-right:4px; margin-right:-6px; }
.funding-list-empty { padding:18px 10px; text-align:center; color:var(--muted); border:1px dashed var(--border); border-radius:10px; font-size:12px; }
.funding-item { display:grid; grid-template-columns:minmax(0,1fr) auto; column-gap:8px; row-gap:4px; align-items:center; padding:9px 11px; border:1px solid rgba(65,74,97,0.45); border-radius:10px; background:rgba(18,21,30,0.55); color:var(--text); cursor:pointer; transition:border-color .12s ease, transform .1s ease, background .12s ease; font-size:12px; }
.funding-item:hover { border-color:#4a5a7c; background:rgba(24,29,40,0.75); transform:translateY(-1px); }
.funding-item.active { border-color:#5f75a8; box-shadow:0 0 0 2px rgba(90,107,150,0.28); background:rgba(32,39,55,0.85); }
.funding-item-name { font-weight:600; grid-column:1/2; font-size:12px; overflow-wrap:anywhere; }
.funding-item-total { justify-self:end; font-weight:600; font-size:12px; padding:2px 8px; border-radius:999px; background:rgba(71,110,172,0.2); color:#cee0ff; font-variant-numeric:tabular-nums;
  box-shadow:0 0 0 1px rgba(94,132,196,0.22) inset; }
.funding-item-total.warn { background:rgba(168,119,44,0.22); box-shadow:0 0 0 1px rgba(190,146,63,0.25) inset; color:#f3cf93; }
.funding-item-total.err { background:rgba(176,67,67,0.22); box-shadow:0 0 0 1px rgba(206,92,92,0.28) inset; color:#ffc3c3; }
.funding-item-tags { grid-column:1/-1; display:flex; flex-wrap:wrap; gap:4px; color:#8ba0c9; }
.funding-item-tags span { border:1px solid rgba(87,103,143,0.45); border-radius:999px; padding:1px 6px; font-size:10px; }
.funding-item-metrics { grid-column:1/-1; display:flex; gap:10px; font-size:10px; text-transform:uppercase; letter-spacing:0.04em; color:#7f8dac; }
.funding-item-metric { display:flex; align-items:center; gap:4px; }

.funding-ledger { min-height:480px; background:var(--card); border:1px solid var(--border); border-radius:12px; padding:16px 18px 20px; display:flex; flex-direction:column; gap:14px; position:relative; }
.funding-empty { margin:auto; text-align:center; color:var(--muted); }
.ledger-budget-card { background:#121622; border:1px solid rgba(74,88,123,0.65); border-radius:12px; padding:14px 16px; display:flex; flex-direction:column; gap:8px; position:sticky; top:68px; z-index:2; box-shadow:0 8px 18px rgba(0,0,0,0.2); }
.ledger-budget-card-react { position:static; background:rgba(16,22,34,0.65); border:1px solid rgba(74,88,123,0.6); border-radius:14px; padding:16px 18px; box-shadow:0 16px 32px rgba(10,18,32,0.28); }
.ledger-budget-card .ledger-line { display:flex; flex-wrap:wrap; gap:8px 12px; align-items:center; font-size:12px; letter-spacing:0.01em; }
.ledger-budget-card .ledger-line strong { font-size:13px; }
.ledger-budget-card .ledger-line .label { text-transform:uppercase; color:#8ea3cd; letter-spacing:0.08em; font-size:11px; }
.ledger-budget-card .ledger-line .value { font-weight:600; font-variant-numeric:tabular-nums; }
.ledger-budget-card .ledger-line.total .value { font-size:14px; color:#cfe0ff; }
.ledger-budget-card .ledger-tags { display:flex; flex-wrap:wrap; gap:6px; }
.ledger-budget-card .ledger-desc { font-size:12px; color:#a9b6d1; line-height:1.5; }
.ledger-budget-card input,
.ledger-budget-card textarea { background:#0c111a; border:1px solid rgba(62,74,105,0.7); border-radius:6px; padding:6px 7px; color:var(--text); font:inherit; font-size:12px; min-width:120px; }
.ledger-budget-card textarea { min-height:32px; resize:none; overflow:hidden; }
.ledger-budget-card .inline-checkbox { display:flex; align-items:center; gap:6px; }
.ledger-budget-card .inline-checkbox input { width:16px; height:16px; }
.ledger-budget-card .ledger-controls { display:flex; justify-content:flex-end; gap:8px; }
.ledger-budget-card .ledger-controls button { font-size:11px; padding:5px 10px; }
.ledger-inline { display:flex; align-items:center; gap:6px; font-size:12px; }
.ledger-inline .inline-label { text-transform:uppercase; letter-spacing:0.08em; color:#7e90b8; font-size:10px; font-weight:600; }
.ledger-inline.value { gap:8px; }
.ledger-inline.value .value { font-size:14px; color:#d2e1ff; }
.ledger-inline input[type="text"],
.ledger-inline input[type="date"],
.ledger-inline textarea { min-width:130px; }
.ledger-inline.inline-checkbox { gap:8px; }
.ledger-inline.inline-checkbox input { width:16px; height:16px; }

.ledger-tree-host {
  display:flex;
  flex-direction:column;
  gap:8px;
  padding:8px 12px 32px;
  width:100%;
  box-sizing:border-box;
  background: var(--card);
  border:1px solid var(--border);
  border-radius:12px;
  --tv-surface: var(--card);
}

.ledger-body { display:flex; flex-direction:column; gap:10px; padding-bottom:36px; }
.ledger-project { border:1px solid var(--border); border-radius:12px; background:#11151f; overflow:hidden; position:relative; }
.ledger-project + .ledger-project { margin-top:4px; }
.ledger-section-header { position:relative; background:rgba(34,42,62,0.55); padding:10px 14px 12px; display:flex; flex-direction:column; gap:6px; border-bottom:1px solid rgba(255,255,255,0.05); }
.ledger-section-header::before { content:""; position:absolute; left:20px; top:22px; bottom:-14px; border-left:1px dotted rgba(123,144,184,0.22); }
.ledger-header-line { display:grid; grid-template-columns:minmax(0,1.4fr) minmax(0,1.1fr) minmax(120px,auto) auto; align-items:center; gap:10px; font-size:12px; font-variant-numeric:tabular-nums; }
.ledger-header-line strong { font-size:13px; }
.ledger-header-line .label { text-transform:uppercase; letter-spacing:0.08em; color:#8ea3cd; font-size:11px; }
.ledger-header-line .amount { justify-self:flex-end; font-weight:600; color:#cfe0ff; }
.ledger-header-line .assets { font-size:11px; color:#8fa0c8; }
.ledger-inline-tags { justify-self:flex-start; }
.ledger-tag-line { display:flex; align-items:center; gap:6px; font-size:11px; color:#8fa0c8; flex-wrap:wrap; }
.ledger-tag-line .tag-line-label { text-transform:uppercase; letter-spacing:0.08em; color:#7e90b8; font-weight:600; font-size:10px; }
.ledger-header-line .ledger-inline.value { justify-self:flex-end; }

.ledger-rows { display:flex; flex-direction:column; gap:var(--tree-gap); }
.ledger-row { display:grid; grid-template-columns:max-content minmax(0,1.4fr) minmax(0,1.1fr) minmax(120px,auto) auto; align-items:center; gap:10px; padding:8px 14px; border-bottom:1px solid rgba(255,255,255,0.04); position:relative; font-size:12px; }
.ledger-row:last-child { border-bottom:none; }
.ledger-row.project { background:rgba(24,29,42,0.45); }
.ledger-row.project::before { display:none; }
.ledger-row.category { background:rgba(16,20,30,0.45); }
.ledger-row.category::before { display:none; }
.ledger-row.category .tree-label { padding-left:0; }
.ledger-row.category.leaf { background:rgba(15,18,27,0.58); }
.ledger-col { min-width:0; display:flex; flex-direction:column; gap:4px; }
.ledger-col.name { font-weight:600; flex:1; }
.ledger-col.name .tree-label { display:flex; align-items:center; gap:6px; flex-wrap:wrap; min-height:32px; width:100%; }
.ledger-tree { display:flex; align-items:stretch; gap:4px; padding-right:4px; position:relative; }
.tree-stems { display:flex; align-items:stretch; gap:0; }
.tree-stem { position:relative; width:16px; flex-shrink:0; }
.tree-stem[data-active="1"]::before { content:""; position:absolute; left:50%; transform:translateX(-50%); top:-1000px; bottom:-1000px; border-left:1px dotted var(--tree-line); pointer-events:none; }
.tree-elbow { position:relative; width:26px; display:flex; align-items:center; justify-content:center; }
.tree-elbow::before { content:""; position:absolute; left:50%; transform:translateX(-50%); top:-1000px; bottom:50%; border-left:1px dotted var(--tree-line); pointer-events:none; }
.tree-elbow::after { content:""; position:absolute; top:50%; left:50%; right:-12px; border-top:1px dotted var(--tree-line); transform:translateY(-50%); pointer-events:none; }
.tree-elbow[data-extend="1"]::before { bottom:-1000px; }
.tree-elbow button { position:relative; z-index:1; }
.tree-root .tree-stems { display:none; }
.tree-elbow-root::before { display:none; }
.ledger-col.name textarea,
.ledger-col.name input { background:#0c111a; border:1px solid rgba(60,72,102,0.6); border-radius:6px; padding:5px 7px; color:var(--text); font:inherit; font-size:12px; min-width:320px; max-width:100%; width:auto; resize:none; overflow:hidden; line-height:1.4; }
.ledger-col.tags { display:flex; align-items:center; }
.ledger-col.tags .tag-region { justify-content:flex-start; width:100%; flex:1; }
.ledger-col.tags .tag-list { flex-wrap:wrap; }
.ledger-col.subtotal { text-align:right; font-variant-numeric:tabular-nums; font-weight:600; justify-self:flex-end; }
.ledger-col.subtotal input,
.ledger-col.subtotal textarea { text-align:right; max-width:140px; background:#0c111a; border:1px solid rgba(60,72,102,0.6); border-radius:6px; padding:5px 7px; color:var(--text); font:inherit; font-size:12px; resize:none; overflow:hidden; line-height:1.4; }
.ledger-actions { display:flex; align-items:center; gap:6px; justify-self:flex-end; }
.ledger-actions button { font-size:11px; padding:4px 8px; }
.ledger-actions .icon-btn { width:26px; height:26px; border-radius:6px; border:1px solid rgba(66,79,111,0.55); background:rgba(17,21,31,0.8); color:#b8c7e8; display:flex; align-items:center; justify-content:center; padding:0; }
.ledger-actions .icon-btn:hover { border-color:#7e94c4; color:#e0e9ff; }
.ledger-actions button:disabled { opacity:0.45; cursor:not-allowed; }
.ledger-children { display:flex; flex-direction:column; gap:var(--tree-gap); padding:6px 0 10px 0; margin-left:0; }
.ledger-children > * { margin-left:0; }
.ledger-row .collapse { width:24px; height:24px; border:1px solid #2d364b; border-radius:6px; background:#0f131d; color:#cfe0ff; cursor:pointer; display:flex; align-items:center; justify-content:center; font-size:12px; }
.ledger-row .collapse:disabled { opacity:.4; cursor:default; }
.asset-chip-row { display:flex; flex-wrap:wrap; gap:6px; align-items:center; }
.asset-chip { display:inline-flex; align-items:center; gap:4px; padding:3px 6px; border-radius:999px; border:1px solid rgba(99,114,150,0.6); background:rgba(49,61,87,0.45); font-size:12px; color:#d7e0ff; }
.asset-chip-remove { border:none; background:none; color:#cfe0ff; cursor:pointer; font-size:12px; padding:0 2px; }
.asset-chip-remove:hover { color:#ffffff; }
.asset-empty { font-size:12px; color:var(--muted); }
.asset-add-btn { margin-top:6px; border:1px dashed rgba(99,114,150,0.7); background:transparent; color:#9fb3df; font-size:12px; padding:3px 8px; border-radius:999px; cursor:pointer; }
.asset-add-btn:hover { border-color:#c5d4ff; color:#cfe0ff; }
.category-amount-wrapper { display:flex; flex-direction:column; gap:4px; align-items:flex-end; width:100%; }
.category-amount-wrapper input { background:#0c111a; border:1px solid rgba(60,72,102,0.6); border-radius:6px; padding:5px 7px; color:var(--text); font:inherit; max-width:120px; text-align:right; }
.tag-picker-panel, .tag-editor-panel { position:absolute; z-index:400; }
.tag-picker { width:260px; background:#0f131d; border:1px solid #2d364b; border-radius:12px; box-shadow:0 18px 32px rgba(0,0,0,0.45); padding:10px; display:flex; flex-direction:column; gap:8px; }
.tag-search { width:100%; padding:8px; border-radius:8px; border:1px solid #2d364b; background:#0a0d14; color:var(--text); font-size:13px; }
.tag-results { display:flex; flex-direction:column; max-height:220px; overflow-y:auto; gap:4px; }
.tag-results.tag-loading .tag-row:not(.skeleton) { opacity:.4; }
.tag-row { display:flex; align-items:center; gap:8px; padding:6px 8px; border-radius:8px; background:rgba(20,24,34,0.6); cursor:pointer; font-size:13px; }
.tag-row:hover, .tag-row.highlight { background:#1c2537; }
.tag-row.disabled { opacity:.45; cursor:default; }
.tag-row.disabled:hover { background:rgba(20,24,34,0.6); }
.tag-row .tag-name { flex:1; }
.tag-row .tag-swatch { width:10px; height:10px; border-radius:50%; background:#4b5771; flex-shrink:0; }
.tag-desc { font-size:11px; color:var(--muted); }
.tag-badge { font-size:10px; padding:2px 6px; border-radius:999px; background:#402235; color:#f6c7d8; border:1px solid #65354d; }
.tag-row-edit { border:none; background:none; color:#9fb3df; font-size:12px; cursor:pointer; padding:0 2px; }
.tag-row-edit:hover { color:#d6e4ff; }
.tag-row.skeleton { height:28px; background:linear-gradient(90deg, rgba(31,39,57,0.3) 0%, rgba(31,39,57,0.65) 50%, rgba(31,39,57,0.3) 100%); animation: shimmer 1.2s infinite linear; border-radius:8px; }
.tag-row.create { justify-content:center; font-style:italic; color:#b9c7eb; }
.tag-row.create:hover { background:#25304a; }

/* Inline tag system */
.tag-region { position:relative; display:flex; align-items:center; justify-content:flex-start; gap:8px; min-height:28px; flex:0 1 auto; }
.ledger-inline-tags { width:100%; }
.ledger-inline-tags .tag-list { justify-content:flex-start; }
.tag-region .tag-list { display:flex; align-items:center; gap:6px; overflow:visible; flex-wrap:wrap; }
.tag-region .tag-list .tag-pill { flex-shrink:0; }
.tag-region .tag-list .tag-placeholder { flex:1; }
.tag-pill { display:inline-flex; align-items:center; height:24px; padding:0 8px; gap:6px; border-radius:999px; border:1px solid var(--tag-border); background:var(--tag-bg); color:#fff; font-size:12px; line-height:1; white-space:nowrap; text-overflow:ellipsis; overflow:hidden; cursor:pointer; transition:background .12s ease, border-color .12s ease, color .12s ease; user-select:none; }
.tag-pill-label { pointer-events:none; }
.tag-pill[data-inherited="1"] { opacity:.75; border-style:dashed; }
.tag-pill[data-tone="warn"] { border-color:var(--tag-warn); background:var(--tag-warn-bg); color:#fff; }
.tag-pill[data-tone="info"] { border-color:var(--tag-info); background:var(--tag-info-bg); color:#fff; }
.tag-pill:hover { background:var(--tag-bg-hover); }
.tag-pill:focus-visible { outline:2px solid var(--ring); outline-offset:2px; }
.tag-pill-remove { border:none; background:transparent; color:inherit; width:16px; height:16px; border-radius:50%; display:flex; align-items:center; justify-content:center; padding:0; font-size:12px; line-height:1; cursor:pointer; transition:background .12s ease, color .12s ease; }
.tag-pill-remove:hover { background:rgba(0,0,0,0.22); }
.tag-pill-remove:focus-visible { outline:2px solid var(--ring); outline-offset:1px; }
.more-pill { font-weight:600; }
.tag-add { opacity:0; border:1px dashed var(--tag-border); background:transparent; color:var(--tag-text); border-radius:999px; height:24px; padding:0 8px; font-size:12px; cursor:pointer; transition:opacity .15s ease; }
.ledger-row:hover .tag-add,
.ledger-section-header:hover .tag-add,
.tag-region:focus-within .tag-add { opacity:1; }
.ledger-budget-card .tag-add { opacity:1; }
.tag-pop { position:absolute; right:0; top:110%; z-index:50; min-width:220px; max-width:360px; padding:10px; border-radius:10px; background:var(--popover-bg); border:1px solid var(--popover-border); box-shadow:0 18px 32px rgba(0,0,0,.45); display:flex; flex-direction:column; gap:6px; }
.tag-pop button { width:100%; text-align:left; }

@keyframes shimmer {
  0% { background-position:-200px 0; }
  100% { background-position:200px 0; }
}

.tag-editor { width:260px; background:#0f131d; border:1px solid #2d364b; border-radius:12px; padding:12px; display:flex; flex-direction:column; gap:12px; box-shadow:0 18px 32px rgba(0,0,0,0.45); }
.tag-editor-header { display:flex; justify-content:space-between; align-items:center; }
.tag-editor-title { font-size:14px; font-weight:600; }
.tag-editor-close { border:none; background:none; color:var(--text); font-size:18px; cursor:pointer; }
.tag-editor-field { display:flex; flex-direction:column; gap:6px; font-size:12px; color:#b6c1da; }
.tag-editor-field.checkbox { flex-direction:row; align-items:center; gap:8px; }
.tag-editor-input-group { display:flex; align-items:center; gap:6px; border:1px solid #2d364b; border-radius:8px; padding:4px 8px; background:#0a0d14; }
.tag-editor-input-group span { color:#6d7aa0; font-size:13px; }
.tag-editor-name { background:transparent; border:none; color:var(--text); font-size:13px; flex:1; outline:none; }
.tag-editor-color { width:100%; height:32px; border-radius:8px; border:1px solid #2d364b; background:#0a0d14; }
.tag-editor-desc { resize:none; overflow:hidden; min-height:60px; background:#0a0d14; border:1px solid #2d364b; border-radius:8px; color:var(--text); padding:6px; }
.tag-editor-actions { display:flex; justify-content:flex-end; gap:8px; }
.tag-editor-actions button { font-size:12px; padding:6px 10px; }
.tag-editor-delete { background:#38191d; border-color:#5c2a30; color:#f4b5bc; }
.tag-editor-delete[disabled] { opacity:.5; cursor:not-allowed; }

.banner { position:fixed; top:16px; right:24px; padding:10px 16px; border-radius:10px; border:1px solid; background:#121722; color:var(--text); box-shadow:0 12px 24px rgba(0,0,0,0.35); z-index:500; }
.banner.hidden { display:none; }
.banner-info { border-color:#334056; color:#d7e2ff; }
.banner-success { border-color:#2a5f3b; background:#122317; color:#98e0b9; }
.banner-warn { border-color:#6b5822; background:#2b2411; color:#f1d28b; }
.banner-error, .banner-err { border-color:#7a2e33; background:#2a1213; color:#f4b5bc; }

/* --- Inspector --- */
.inspector-panel { gap:16px; }
.inspector-sub { font-size:13px; color:#aab3c7; }
.inspector-section { display:flex; flex-direction:column; gap:8px; padding:12px; background:#10141f; border:1px solid var(--border); border-radius:10px; }
.inspector-meta { font-size:12px; color:#c0c8dc; }
.inspector-tags { display:flex; flex-direction:column; gap:6px; }
.inspector-title { font-size:12px; color:#8fa5ce; text-transform:uppercase; letter-spacing:0.05em; }
.inspector-actions { display:flex; justify-content:flex-end; }
.inspector-actions button { font-size:12px; padding:6px 10px; }

/* --- Tag Manager --- */
.tag-manager { display:flex; flex-direction:column; gap:16px; }
.tag-manager-header { display:flex; justify-content:space-between; align-items:center; }
.tag-manager-actions { display:flex; gap:8px; }
.tag-manager-search { display:flex; }
.tag-manager-table { background:var(--card); border:1px solid var(--border); border-radius:12px; padding:12px; }
.tag-table { width:100%; border-collapse:collapse; font-size:13px; }
.tag-table th, .tag-table td { padding:10px 12px; border-bottom:1px solid var(--border); text-align:left; vertical-align:middle; }
.tag-table th { font-size:12px; color:#9fb0cf; text-transform:uppercase; letter-spacing:0.05em; }
.tag-cell { display:flex; align-items:center; gap:8px; }
.tag-name { font-weight:600; }
.tag-usage { display:flex; gap:8px; flex-wrap:wrap; font-size:11px; color:#9aa8c7; }

/* --- New React funding layout helpers --- */
.summary-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(160px,1fr)); gap:12px; }
.info-field { display:flex; flex-direction:column; gap:6px; background:#101623; border:1px solid rgba(58,70,99,0.6); border-radius:8px; padding:10px 12px; }
.info-field-label { font-size:10px; letter-spacing:0.08em; text-transform:uppercase; color:#8593b5; }
.info-field-input { background:#0d1320; border:1px solid rgba(70,83,110,0.6); border-radius:6px; padding:6px 8px; color:#e8efff; font:inherit; font-size:13px; }
.info-field-input:focus { border-color:#5a80ff; outline:none; box-shadow:0 0 0 1px rgba(90,128,255,0.4); }
.info-field textarea.info-field-input { min-height:64px; resize:vertical; }
.toggle-field { flex-direction:row; align-items:center; justify-content:space-between; }
.toggle-field input { width:16px; height:16px; }
.static-field .info-field-value { font-size:14px; font-weight:600; color:#cfe0ff; }
.summary-description { margin-top:16px; background:#101623; border:1px solid rgba(58,70,99,0.6); border-radius:10px; padding:12px 14px; font-size:12px; color:#a7b2d3; line-height:1.5; }
.summary-tags { margin-top:12px; display:flex; flex-wrap:wrap; gap:8px; }
.summary-tags span { border-radius:999px; padding:2px 10px; background:#182036; border:1px solid rgba(80,98,140,0.6); font-size:11px; color:#d7e2ff; }
.hierarchy-tree { display:flex; flex-direction:column; gap:6px; background:rgba(16,22,34,0.65); border:1px solid rgba(62,74,105,0.6); border-radius:12px; padding:12px; }
.hierarchy-node { display:flex; flex-direction:column; gap:4px; }
.hierarchy-row { display:flex; align-items:center; justify-content:space-between; gap:12px; padding:6px 8px; border-radius:8px; background:rgba(20,27,41,0.6); border:1px solid rgba(72,88,120,0.55); color:#e8efff; cursor:pointer; transition:background .12s ease, border-color .12s ease; }
.hierarchy-row.leaf { cursor:default; }
.hierarchy-row:hover { background:rgba(36,48,74,0.7); border-color:rgba(112,136,190,0.6); }
.hierarchy-main { display:flex; align-items:center; gap:10px; min-width:0; flex:1; }
.hierarchy-toggle { width:16px; text-align:center; color:#90a4d6; }
.hierarchy-toggle-placeholder { width:16px; text-align:center; color:#44506b; }
.tree-pill { font-size:10px; letter-spacing:0.08em; text-transform:uppercase; padding:2px 6px; border-radius:999px; border:1px solid rgba(96,118,176,0.45); background:#202a41; color:#cfe0ff; flex-shrink:0; }
.tree-name { font-size:13px; font-weight:600; color:#f0f5ff; overflow-wrap:anywhere; }
.hierarchy-meta { font-size:12px; color:#9eb2ff; font-variant-numeric:tabular-nums; }
.hierarchy-children { display:flex; flex-direction:column; gap:4px; margin-left:18px; padding-left:12px; border-left:1px dashed rgba(96,112,150,0.45); }
.hierarchy-empty { padding:20px 12px; text-align:center; color:#7587ae; background:rgba(16,22,34,0.6); border:1px solid rgba(62,74,105,0.55); border-radius:12px; }

.ledger-main { display:flex; gap:18px; align-items:flex-start; }
.ledger-main > * { flex:1; min-width:0; }
.inspector-panel { display:flex; flex-direction:column; gap:16px; background:#101623; border:1px solid rgba(62,74,105,0.6); border-radius:12px; padding:16px; box-shadow:0 16px 32px rgba(10,18,32,0.28); max-width:320px; }
.inspector-placeholder { text-align:center; color:#7a8cb5; font-size:12px; padding:20px 12px; }
.inspector-heading { margin:0 0 8px; font-size:12px; letter-spacing:0.08em; color:#7f90b5; }
.inspector-heading-row { display:flex; justify-content:space-between; align-items:center; }
.inspector-heading-row h4 { margin:0; font-size:12px; letter-spacing:0.08em; color:#7f90b5; text-transform:uppercase; }
.mini-btn { border:1px solid rgba(90,128,255,0.4); background:rgba(90,128,255,0.12); color:#cfe0ff; padding:4px 10px; border-radius:999px; font-size:11px; cursor:pointer; transition:background .16s ease, transform .16s ease; }
.mini-btn:hover { background:rgba(90,128,255,0.22); transform:translateY(-1px); }
.inspector-tags-group { display:flex; flex-direction:column; gap:6px; }
.inspector-tags-group.muted { opacity:.8; }
.inspector-tags-label { font-size:10px; text-transform:uppercase; letter-spacing:0.08em; color:#6f82a8; }
.inspector-tags { display:flex; flex-wrap:wrap; gap:6px; }
.inspector-empty { font-size:12px; color:#6f82a8; }
.hierarchy-row.active { border-color:rgba(112,136,190,0.75); background:rgba(40,54,88,0.75); }
.hierarchy-row.leaf { cursor:default; }
.hierarchy-row.leaf .hierarchy-toggle { visibility:hidden; }
.hierarchy-meta .tree-amount { font-weight:600; }
.hierarchy-row .tree-pill-project { background:#1e2d4c; border-color:rgba(112,136,190,0.6); }
.hierarchy-row .tree-pill-category { background:#182236; border-color:rgba(112,136,190,0.45); }
.hierarchy-row .tree-pill-budget { background:#233250; border-color:rgba(140,160,210,0.65); }
.table-panel { background:rgba(16,22,34,0.65); border:1px solid rgba(62,74,105,0.6); border-radius:12px; padding:12px; overflow-x:auto; }
.summary-table { width:100%; border-collapse:collapse; font-size:12px; color:#d8e2ff; }
.summary-table th { text-align:left; font-size:11px; text-transform:uppercase; letter-spacing:0.06em; color:#7f90b5; padding:8px 10px; border-bottom:1px solid rgba(75,90,120,0.5); }
.summary-table td { padding:8px 10px; border-bottom:1px solid rgba(40,50,70,0.4); }
.summary-table tr:last-child td { border-bottom:none; }
.history-list { list-style:none; margin:0; padding:0; display:flex; flex-direction:column; gap:8px; }
.history-entry { display:flex; flex-direction:column; gap:4px; background:rgba(18,24,38,0.6); border:1px solid rgba(58,70,99,0.55); border-radius:8px; padding:8px 10px; }
.history-label { font-size:11px; text-transform:uppercase; letter-spacing:0.06em; color:#7f90b5; }
.history-detail { font-size:12px; color:#d7e2ff; }
.tag-actions { display:flex; gap:6px; }
.tag-actions button { font-size:12px; padding:4px 8px; }
.tag-empty { padding:24px 12px; text-align:center; color:var(--muted); }

/* --- Modal --- */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(6, 8, 12, 0.72);
  backdrop-filter: blur(2px);
  display: flex;
  align-items: flex-start;
  justify-content: center;
  padding: 80px 16px 40px;
  z-index: 1200;
}
.modal {
  background: #11141d;
  border: 1px solid var(--border);
  border-radius: 16px;
  box-shadow: 0 24px 48px rgba(0, 0, 0, 0.45);
  width: min(480px, 96vw);
}
.modal-form {
  display: flex;
  flex-direction: column;
  gap: 16px;
  padding: 20px;
}
.modal-form h3 {
  margin: 0;
  font-size: 18px;
  color: #e0e6ff;
}
.modal-body {
  display: flex;
  flex-direction: column;
  gap: 12px;
}
.modal-field {
  display: flex;
  flex-direction: column;
  gap: 6px;
  font-size: 13px;
  color: #b7c0d4;
}
.modal-field-checkbox {
  flex-direction: row;
  align-items: center;
  gap: 10px;
}
.modal-field input,
.modal-field textarea,
.modal-field select {
  background: #0c101a;
  border: 1px solid #2d364b;
  border-radius: 8px;
  padding: 8px;
  color: var(--text);
  font: inherit;
}
.modal-field textarea {
  resize: none;
  overflow: hidden;
  min-height: 32px;
}
.modal-required {
  color: var(--warn);
  margin-left: 4px;
}
.modal-hint {
  color: #8fa5ce;
  font-size: 11px;
}
.modal-actions {
  display: flex;
  justify-content: flex-end;
  gap: 8px;
}
.modal-actions button {
  font-size: 13px;
  padding: 8px 14px;
}
.modal-submit {
  background: #42598f;
  border-color: #5f7ad3;
  color: #e5ecff;
}
.modal-submit:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}
.modal-cancel {
  background: transparent;
  border-color: #2d364b;
}
.modal-error {
  padding: 8px 12px;
  border-radius: 8px;
  background: #2a1213;
  border: 1px solid #7a2e33;
  color: #f4b5bc;
  font-size: 12px;
}
.modal-error.hidden {
  display: none;
}
.modal-form.modal-busy {
  opacity: 0.7;
}
